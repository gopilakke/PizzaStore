package com.pizzastore.user.controller; import com.pizzastore.user.entity.MenuItem; import com.pizzastore.user.entity.OrderEntity; import com.pizzastore.user.entity.User; import com.pizzastore.user.repository.MenuItemRepository; import com.pizzastore.user.repository.OrderRepository; import com.pizzastore.user.repository.UserRepository; import org.springframework.stereotype.Controller; import org.springframework.ui.Model; import org.springframework.web.bind.annotation.*; import javax.annotation.PostConstruct; import java.util.List; @Controller @RequestMapping("/user") public class UserController { private final UserRepository userRepo; private final MenuItemRepository menuRepo; private final OrderRepository orderRepo; public UserController(UserRepository userRepo, MenuItemRepository menuRepo, OrderRepository orderRepo){ this.userRepo = userRepo; this.menuRepo = menuRepo; this.orderRepo = orderRepo; } @PostConstruct public void initData(){ if(menuRepo.count()==0){ menuRepo.save(new MenuItem("Margherita","Pizza","Classic cheese",199.0)); menuRepo.save(new MenuItem("Pepperoni","Pizza","Pepperoni & cheese",249.0)); menuRepo.save(new MenuItem("Coke","Beverage","Chilled coke",49.0)); } } @GetMapping("/register") public String registerForm(Model model){ model.addAttribute("user", new User()); return "register"; } @PostMapping("/register") public String register(@ModelAttribute User user, Model model){ userRepo.save(user); model.addAttribute("message","Registration successful. Please login."); return "login"; } @GetMapping("/login") public String loginForm(){ return "login"; } @GetMapping("/menu") public String menu(@RequestParam(required=false) String category, Model model){ List<MenuItem> items; if(category!=null) items = menuRepo.findByCategoryIgnoreCase(category); else items = menuRepo.findAll(); model.addAttribute("menuItems", items); return "menu"; } @PostMapping("/orders") public String placeOrder(@RequestParam Long userId, @RequestBody OrderEntity order){ order.setStatus("PLACED"); orderRepo.save(order); return "redirect:/user/menu"; } }
